#!/bin/sh
# SPDX-License-Identifier: CC0-1.0

if [ "$CC" = "" ]; then CC=gcc; fi
if [ "$CFLAGS" = "" ]; then CFLAGS=-O3; fi
src=`realpath $0`
src=`dirname $src`
src=`echo -n "$src" | sed "s/[\$ :]/\$&/g"`

cat >build.ninja <<END
ninja_required_version = 1.3
cflags = -Wall $CFLAGS
rule cc
    depfile = \$out.d
    deps = gcc
    command = $CC -MD -MF \$out.d \$cflags \$flags \$in -o \$out

build usbtool: cc $src/usbtool.c
    flags =  `pkg-config --libs --cflags libusb-1.0`
build idbtool: cc $src/idbtool.c
build regtool: cc $src/regtool.c $src/regtool_rpn.c
build unpacktool: cc $src/unpacktool.c $src/../compression/lz4.c $src/../compression/inflate.c $src/../compression/zstd.c $src/../compression/zstd_sequences.c $src/../compression/zstd_literals.c $src/../compression/zstd_probe_literals.c $src/../compression/zstd_fse.c $src/../compression/lzcommon.c
    flags = -DHAVE_LZ4 -DHAVE_GZIP -DHAVE_ZSTD

default usbtool idbtool regtool unpacktool
END
